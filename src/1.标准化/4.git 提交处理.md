# git pre-commit

Git 有很多的 hooks，让我们在不同的阶段，对代码进行不同的操作，控制提交到仓库的代码的规范性,和准确性，以下只是几个常用的钩子：

- **pre-commit**：判断提交的代码是否符合规范。
- **commit-msg**：判断 commit 信息是否符合规范。

## 1.工具

**husky**：操作 git 钩子的工具。

通过以下命令进行安装：

```shell
npm i husky -D
```

## 2.pre-commit

在 git 提交的 **pre-commit** 阶段，对暂存的文件，进行校验及格式化，确保提交的代码或文件满足相应的规范。

此处我们需要 **lint-staged** 工具，该工具结合 **husky** 让我们可以对已暂存的文件进行相应的处理。

### 安装

```shell
npm i lint-staged -D
```

依次执行以下命令：

```shell
# 在package.json中添加脚本
npm set-script prepare "husky install"
# 初始化 husky，将 git hooks 钩子交由，husky 执行
npm run prepare
```

此时，会在根目录创建 **.husky** 文件夹，继续执行以下命令：

```shell
npx husky add .husky/pre-commit "npx lint-staged"
```

这个时候，会在 **.husky** 文件下，新增 **pre-commit** 文件，在 git 提交的 **pre-commit** 阶段，执行 **npx lint-staged** 命令，对暂存的文件进行处理。

此时，我们只配置了对暂存文件需要处理，但怎么处理，还未进行声明。

在根目录下，新增 **.lintstagedrc.json** 文件，用于控制对文件进行如何处理。（也可在 **package.json** 文件下，增加 **lint-staged** 属性，进行配置）

```json
{
  "*.{js,ts}": ["prettier --write .", "eslint --fix"],
  "*.md": ["prettier --write"]
}
```

上述文件，声明对：

- 对 JS 及 TS 文件，先进行 **prettier** 处理，再进行 **eslint** 处理。
- 对 MD 文件，进行 **prettier** 处理。
